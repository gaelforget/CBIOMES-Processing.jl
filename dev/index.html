<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>CbiomesProcessing.jl documentation · CbiomesProcessing</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>CbiomesProcessing</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>CbiomesProcessing.jl documentation</a><ul class="internal"><li><a class="toctext" href="#Contents-1">Contents</a></li><li><a class="toctext" href="#Main-Features-1">Main Features</a></li><li><a class="toctext" href="#Index-1">Index</a></li><li><a class="toctext" href="#API-/-Functions-1">API / Functions</a></li></ul></li><li><a class="toctext" href="sepdev1/">Move API here?</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>CbiomesProcessing.jl documentation</a></li></ul><a class="edit-page" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>CbiomesProcessing.jl documentation</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="CbiomesProcessing.jl-documentation-1" href="#CbiomesProcessing.jl-documentation-1">CbiomesProcessing.jl documentation</a></h1><p><strong>CbiomesProcessing.jl</strong> provides a simple, distributed workflow to e.g. post-process binary model output. Inter-operability with <code>MeshArrays.jl</code> and <code>NCTiles.jl</code> is an important prospect of this package.</p><h2><a class="nav-anchor" id="Contents-1" href="#Contents-1">Contents</a></h2><ul><li><a href="#CbiomesProcessing.jl-documentation-1">CbiomesProcessing.jl documentation</a></li><ul><li><a href="#Contents-1">Contents</a></li><li><a href="#Main-Features-1">Main Features</a></li><li><a href="#Index-1">Index</a></li><li><a href="#API-/-Functions-1">API / Functions</a></li></ul><li><a href="sepdev1/#Move-API-here?-1">Move API here?</a></li></ul><h2><a class="nav-anchor" id="Main-Features-1" href="#Main-Features-1">Main Features</a></h2><p>Currently the reference implementation consists of</p><ul><li><a href="#CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}"><code>TaskDriver()</code></a> (inside <code>utilities.jl</code>) is the driver function<ul><li>It calls e.g. <code>loop_task1.(i)</code></li></ul></li><li><a href="#CbiomesProcessing.loop_task1-Tuple{Int64}"><code>CbiomesProcessing.loop_task1(indx::Int)</code></a> (inside <code>fileloops.jl</code>) loads <code>M</code> from <code>MTRX.jld</code><ul><li>It calls <code>loop_task1(indx,M)</code></li></ul></li><li><a href="#CbiomesProcessing.loop_task1-Tuple{Any,Any}"><code>CbiomesProcessing.loop_task1(indx,M)</code></a> (inside <code>fileloops.jl</code>) loops over files and variables<ul><li>It calls <code>MatrixInterp(in,MTRX,siz)</code> and writes result to a <code>FortranFile</code></li></ul></li></ul><p><a href="#API-/-Functions-1">API / Functions</a> further documents the <code>CbiomesProcessing</code> module functions that are included in:</p><ul><li><code>examples.jl</code> includes simple examples without <code>TaskDriver</code>.</li><li><code>fileloops.jl</code> includes task loops such as <code>CbiomesProcessing.loop_task1()</code>](@ref). A real-life example is provided in the <a href="#CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}"><code>TaskDriver</code></a> documentation reported below.</li><li><code>utilities.jl</code> provides low-level functions such as <a href="#CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}"><code>TaskDriver</code></a>, <a href="#CbiomesProcessing.MatrixInterp-Union{Tuple{N}, Tuple{T}, Tuple{Array{T,N},SparseMatrixCSC,Any}} where N where T"><code>MatrixInterp()</code></a>, and <a href="#CbiomesProcessing.MetaFileRead-Tuple{String}"><code>MetaFileRead()</code></a>.</li></ul><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="#CbiomesProcessing.MatrixInterp-Union{Tuple{N}, Tuple{T}, Tuple{Array{T,N},SparseMatrixCSC,Any}} where N where T"><code>CbiomesProcessing.MatrixInterp</code></a></li><li><a href="#CbiomesProcessing.MetaFileRead-Tuple{String}"><code>CbiomesProcessing.MetaFileRead</code></a></li><li><a href="#CbiomesProcessing.StartWorkers-Tuple{Int64}"><code>CbiomesProcessing.StartWorkers</code></a></li><li><a href="#CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}"><code>CbiomesProcessing.TaskDriver</code></a></li><li><a href="#CbiomesProcessing.cbioproc_example1-Tuple{}"><code>CbiomesProcessing.cbioproc_example1</code></a></li><li><a href="#CbiomesProcessing.cbioproc_example2-Tuple{}"><code>CbiomesProcessing.cbioproc_example2</code></a></li><li><a href="#CbiomesProcessing.loop_exampleA-Tuple{Any,Any,Any}"><code>CbiomesProcessing.loop_exampleA</code></a></li><li><a href="#CbiomesProcessing.loop_exampleB-Tuple{Any,Any,Any}"><code>CbiomesProcessing.loop_exampleB</code></a></li><li><a href="#CbiomesProcessing.loop_task1-Tuple{Any,Any}"><code>CbiomesProcessing.loop_task1</code></a></li><li><a href="#CbiomesProcessing.loop_task1-Tuple{Int64}"><code>CbiomesProcessing.loop_task1</code></a></li><li><a href="#CbiomesProcessing.loop_task2-Tuple{Any}"><code>CbiomesProcessing.loop_task2</code></a></li><li><a href="#CbiomesProcessing.loop_task3-Tuple{Any}"><code>CbiomesProcessing.loop_task3</code></a></li><li><a href="#CbiomesProcessing.loop_task4-Tuple{Any}"><code>CbiomesProcessing.loop_task4</code></a></li><li><a href="#CbiomesProcessing.prep_MTRX-Tuple{}"><code>CbiomesProcessing.prep_MTRX</code></a></li><li><a href="#CbiomesProcessing.read_SPM-Tuple{String}"><code>CbiomesProcessing.read_SPM</code></a></li></ul><h2><a class="nav-anchor" id="API-/-Functions-1" href="#API-/-Functions-1">API / Functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.MatrixInterp-Union{Tuple{N}, Tuple{T}, Tuple{Array{T,N},SparseMatrixCSC,Any}} where N where T" href="#CbiomesProcessing.MatrixInterp-Union{Tuple{N}, Tuple{T}, Tuple{Array{T,N},SparseMatrixCSC,Any}} where N where T"><code>CbiomesProcessing.MatrixInterp</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">MatrixInterp(in::Array{T,N},MTRX,siz) where {T,N}</code></pre><p>Interpolate <code>in</code> using <code>MTRX</code> to grid of size <code>siz</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/utilities.jl#L104-L108">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.MetaFileRead-Tuple{String}" href="#CbiomesProcessing.MetaFileRead-Tuple{String}"><code>CbiomesProcessing.MetaFileRead</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">MetaFileRead(filIn::String)</code></pre><p>Reads a meta file generated by MITgcm</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/utilities.jl#L49-L53">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.StartWorkers-Tuple{Int64}" href="#CbiomesProcessing.StartWorkers-Tuple{Int64}"><code>CbiomesProcessing.StartWorkers</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">StartWorkers(nwrkrs::Int)</code></pre><p>Start workers if needed.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/utilities.jl#L3-L7">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}" href="#CbiomesProcessing.TaskDriver-Tuple{Union{UnitRange{Int64}, Int64, Array{Int64,1}},Function}"><code>CbiomesProcessing.TaskDriver</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">TaskDriver(indx,fn)</code></pre><p>Broacast / distribute task (fn; e.g. loop_task1) over indices (indx; e.g. file indices)</p><p>Examples:</p><pre><code class="language-none">using CbiomesProcessing, Distributed, SparseArrays
TaskDriver(1,CbiomesProcessing.loop_task1)

StartWorkers(4)
@everywhere using CbiomesProcessing, SparseArrays
TaskDriver(1:4,CbiomesProcessing.loop_task1)</code></pre><p>Visualize results:</p><pre><code class="language-none">using FortranFiles, Plots
k=1
recl=720*360*4
fil=&quot;diags_interp/ETAN/ETAN.0000000732.data&quot;
f =  FortranFile(fil,&quot;r&quot;,access=&quot;direct&quot;,recl=recl,convert=&quot;big-endian&quot;)
tmp=read(f,rec=k,(Float32,(720,360))); close(f)
heatmap(tmp)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/utilities.jl#L14-L41">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.cbioproc_example1-Tuple{}" href="#CbiomesProcessing.cbioproc_example1-Tuple{}"><code>CbiomesProcessing.cbioproc_example1</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">cbioproc_example1()</code></pre><p>A 3D example without land mask or MeshArrays.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L4-L8">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.cbioproc_example2-Tuple{}" href="#CbiomesProcessing.cbioproc_example2-Tuple{}"><code>CbiomesProcessing.cbioproc_example2</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">cbioproc_example2()</code></pre><p>A 2D example with MeshArrays + mask or loop.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L25-L29">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_exampleA-Tuple{Any,Any,Any}" href="#CbiomesProcessing.loop_exampleA-Tuple{Any,Any,Any}"><code>CbiomesProcessing.loop_exampleA</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_exampleA(indx,SPM,siz)</code></pre><p>Applies <code>MatrixInterp</code> in a loop over a subset of model output files (<code>filList[indx]</code>)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L54-L58">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_exampleB-Tuple{Any,Any,Any}" href="#CbiomesProcessing.loop_exampleB-Tuple{Any,Any,Any}"><code>CbiomesProcessing.loop_exampleB</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_exampleB(indx,SPM,siz)</code></pre><p>Applies <code>MatrixInterp</code> in a loop over a subset of model output files (<code>filList[indx]</code>)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L85-L89">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_task1-Tuple{Any,Any}" href="#CbiomesProcessing.loop_task1-Tuple{Any,Any}"><code>CbiomesProcessing.loop_task1</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_task1(indx,M)</code></pre><p>Loop over a subset of model output files (<code>filList[indx]</code>), apply <code>MatrixInterp</code> (<code>M</code>) as a postprocessing step, and write the result to file (one subfolder for each variable)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/fileloops.jl#L13-L19">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_task1-Tuple{Int64}" href="#CbiomesProcessing.loop_task1-Tuple{Int64}"><code>CbiomesProcessing.loop_task1</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_task1(indx::Int)</code></pre><p>Interpolate all variables for one record</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/fileloops.jl#L2-L6">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_task2-Tuple{Any}" href="#CbiomesProcessing.loop_task2-Tuple{Any}"><code>CbiomesProcessing.loop_task2</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_task2(indx)</code></pre><p>Loop over a subset of model output files (<code>filList[indx]</code>), convert Rirr* to Satellite Chl as a postprocessing step, and write the result to file (one subfolder for each variable)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/fileloops.jl#L80-L86">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_task3-Tuple{Any}" href="#CbiomesProcessing.loop_task3-Tuple{Any}"><code>CbiomesProcessing.loop_task3</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_task3(indx)</code></pre><p>Loop over a subset of model output files (<code>filList[indx]</code>), compute export as a postprocessing step, and write the result to file (one subfolder for each variable)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/fileloops.jl#L173-L179">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.loop_task4-Tuple{Any}" href="#CbiomesProcessing.loop_task4-Tuple{Any}"><code>CbiomesProcessing.loop_task4</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">loop_task4(indx)</code></pre><p>Loop over model output files and time average them as a postprocessing step, and write the result to file (one subfolder for each variable)</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/fileloops.jl#L242-L248">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.prep_MTRX-Tuple{}" href="#CbiomesProcessing.prep_MTRX-Tuple{}"><code>CbiomesProcessing.prep_MTRX</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">prep_MTRX()</code></pre><p>Repackage interpolation matrix, mask, etc to <code>.jld</code> file.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L125-L129">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CbiomesProcessing.read_SPM-Tuple{String}" href="#CbiomesProcessing.read_SPM-Tuple{String}"><code>CbiomesProcessing.read_SPM</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">read_SPM(dirIn::String)</code></pre><p>Reads pre-computed interpolation (sparse matrix) from <code>dirIn*&quot;interp_precomputed.mat&quot;</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/gaelforget/CBIOMES-Processing.jl/blob/0043098079eccf3a93b4e843941e6658f5df4745/src/examples.jl#L156-L161">source</a></section><footer><hr/><a class="next" href="sepdev1/"><span class="direction">Next</span><span class="title">Move API here?</span></a></footer></article></body></html>
